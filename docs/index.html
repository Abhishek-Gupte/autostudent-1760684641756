<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Create a captcha solver that handles ?url=...</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
<style>
  body { padding: 2rem; }
  .preview { max-width: 420px; border: 1px dashed #aaa; padding: 8px; }
  code { user-select: all; }
</style>
</head>
<body class="container">
  <h1 class="mb-3">Captcha Solver (Demo)</h1>
  <p class="text-muted">Pass an image via <code>?url=https://.../image.png</code>. If absent, I’ll use the attached sample.</p>

  <div class="row g-4">
    <div class="col-md-6">
      <h5>Captcha Image</h5>
      <img id="captcha-img" class="preview" alt="captcha"/>
      <div class="mt-2">
        <button id="run-ocr" class="btn btn-primary btn-sm">Solve</button>
        <span id="status" class="ms-2" aria-live="polite"></span>
      </div>
    </div>
    <div class="col-md-6">
      <h5>OCR Result (≤ 15s)</h5>
      <pre id="ocr-text" class="p-2 bg-light" style="min-height:120px;"></pre>
    </div>
  </div>

  <hr/>
  <p class="small">Checks: loads ?url image and shows solved text.</p>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.0.4/dist/tesseract.min.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const img = document.getElementById('captcha-img');
    const runBtn = document.getElementById('run-ocr');
    const out = document.getElementById('ocr-text');
    const status = document.getElementById('status');

    const fallback = "";
    const inputUrl = params.get('url') || fallback;
    if (inputUrl) img.src = inputUrl;
    else status.textContent = "No ?url and no sample image.";

    runBtn.addEventListener('click', async () => {
      if (!img.src) { status.textContent = "No image."; return; }
      status.textContent = "Running OCR...";
      try {
        const worker = await Tesseract.createWorker('eng');
        const controller = new AbortController();
        const timer = setTimeout(() => controller.abort(), 15000);
        const { data: { text } } = await worker.recognize(img.src, { signal: controller.signal });
        clearTimeout(timer);
        await worker.terminate();
        out.textContent = (text || "").trim();
        status.textContent = "Done";
      } catch (e) {
        status.textContent = "OCR failed: " + (e.message || e);
      }
    });
  </script>
</body>
</html>